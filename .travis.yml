sudo: required

env:
  global:
    - DOCKER_VERSION=17.03.1~ce-0~ubuntu-trusty

services:
  - docker

branches:
  except:
    - "/^\\d{14}/"

language: go

go:
  - 1.7

before_install:
  - source ./ci/correct-path.sh

  # upgrade docker-ce to specific version
  - sudo apt-get -o Dpkg::Options::="--force-confnew" install -y docker-ce=${DOCKER_VERSION}
  - docker version

script:
  - ./ci/set-client-id.sh
  - go get ./cmd/convox
  - make test

deploy:
  provider: script
  script: ci/deploy.sh
  on:
    branch: goodeggs
